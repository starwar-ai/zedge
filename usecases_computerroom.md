# 机房管理用例文档 (Computer Room Management Use Cases)

## 目录
- [1. 机房管理](#1-机房管理)
- [2. 服务器管理](#2-服务器管理)
- [3. 算力机管理](#3-算力机管理)
- [4. 云盒管理](#4-云盒管理)

---

## 1. 机房管理

### 1.1 创建机房 (Create Computer Room)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 管理员具有机房管理权限

**基本流程**:
1. 管理员选择"创建机房"功能
2. 系统显示机房信息表单
3. 管理员输入以下信息:
   - 机房名称 (e.g., 北京数据中心)
   - 物理位置 (e.g., 北京市海淀区)
   - 网络配置:
     - 管理网网段 (e.g., 192.168.1.0/24)
     - 管理网网关 (e.g., 192.168.1.1)
     - 业务网网段 (e.g., 10.0.0.0/16)
     - 业务网网关 (e.g., 10.0.0.1)
4. 系统验证输入信息的有效性:
   - 网段格式正确性
   - 管理网和业务网网段不重叠
5. 系统创建机房记录，状态设置为 "offline"
6. 系统初始化资源统计:
   - 总CPU核心数 = 0
   - 总内存容量 = 0
   - 总存储容量 = 0
7. 系统保存网络配置
8. 系统返回机房ID和创建成功信息

**说明**:
- 机房的资源配置会在添加服务器、算力机等设备时自动累加统计，无需手工设置
- 管理网用于设备管理、监控等管理流量；业务网用于虚拟机实例、用户访问等业务流量

**后置条件**:
- 新机房记录已保存到数据库
- 机房状态为 "offline"

**异常流程**:
- 4a. 如果必填字段缺失:
  - 系统提示缺失字段信息
  - 返回步骤3
- 4b. 如果机房名称重复:
  - 系统提示名称已存在
  - 返回步骤3

---

### 1.2 查看机房详情 (View Computer Room Details)

**参与者**: 系统管理员、运维人员

**前置条件**:
- 用户已登录系统
- 用户具有机房查看权限
- 系统中存在至少一个机房

**基本流程**:
1. 用户选择"机房列表"功能
2. 系统显示所有机房列表，包含:
   - 机房名称
   - 位置
   - 运营状态
   - 资源使用率概览
3. 用户选择要查看的机房
4. 系统显示机房详细信息:
   - 基本信息（名称、位置、状态）
   - 网络配置（管理网网段/网关、业务网网段/网关）
   - 资源配置（总CPU、内存、存储）
   - 资源使用情况（已用/总量）
   - 包含的服务器列表
   - 包含的算力机列表
   - 包含的云盒列表
5. 用户可查看各项统计数据和图表

**后置条件**:
- 用户获得机房详细信息

---

### 1.3 更新机房状态 (Update Computer Room Status)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 管理员具有机房管理权限
- 目标机房存在

**基本流程**:
1. 管理员进入机房详情页
2. 管理员选择"修改状态"操作
3. 系统显示当前状态和可选状态:
   - \`offline\` → \`active\` 或 \`maintenance\`
   - \`active\` → \`maintenance\` 或 \`offline\`
   - \`maintenance\` → \`active\` 或 \`offline\`
4. 管理员选择目标状态
5. 系统验证状态转换的合法性
6. 系统检查状态转换的影响:
   - 如果转为 \`offline\`，检查是否有运行中的实例
   - 如果转为 \`maintenance\`，提示维护计划
7. 管理员确认状态变更
8. 系统更新机房状态
9. 系统记录状态变更日志

**后置条件**:
- 机房状态已更新
- 操作日志已记录

**异常流程**:
- 6a. 如果机房有运行中的实例且要转为 \`offline\`:
  - 系统提示需要先迁移或停止实例
  - 提供实例列表
  - 操作取消或等待处理完成

---

### 1.4 更新机房网络配置 (Update Computer Room Network Configuration)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 管理员具有机房管理权限
- 目标机房存在

**基本流程**:
1. 管理员进入机房详情页
2. 管理员选择"修改网络配置"操作
3. 系统显示当前网络配置:
   - 管理网网段和网关
   - 业务网网段和网关
4. 管理员修改网络配置信息
5. 系统验证新配置:
   - 网段格式正确性
   - 管理网和业务网网段不重叠
   - 新网段是否会影响现有设备
6. 如果有设备IP在新网段之外，系统显示警告:
   - 列出受影响的设备
   - 提示需要调整设备IP
7. 管理员确认变更
8. 系统更新网络配置
9. 系统记录配置变更日志

**后置条件**:
- 机房网络配置已更新
- 操作日志已记录

**异常流程**:
- 5a. 如果网段格式错误:
  - 系统提示格式错误详情
  - 返回步骤4
- 5b. 如果管理网和业务网网段重叠:
  - 系统提示网段冲突
  - 返回步骤4

---

### 1.5 删除机房 (Delete Computer Room)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 管理员具有机房管理权限
- 目标机房存在

**基本流程**:
1. 管理员进入机房详情页
2. 管理员选择"删除机房"操作
3. 系统检查机房是否可删除:
   - 检查是否有关联的服务器
   - 检查是否有关联的算力机
   - 检查是否有运行中的实例
   - 检查是否有云盒设备
4. 系统显示删除确认对话框，列出所有依赖项
5. 管理员确认删除操作
6. 系统执行软删除（标记为已删除，不物理删除）
7. 系统记录删除日志
8. 系统返回机房列表页

**后置条件**:
- 机房已标记为删除状态
- 删除操作已记录到审计日志

**异常流程**:
- 3a. 如果机房有运行中的实例或设备:
  - 系统提示无法删除
  - 显示阻止删除的资源列表
  - 提供清理建议
  - 操作取消

---

## 2. 服务器管理

### 2.1 添加管理服务器 (Add Management Server)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 目标机房存在且状态为 \`active\` 或 \`maintenance\`

**基本流程**:
1. 管理员选择"添加管理服务器"功能
2. 系统显示服务器信息表单
3. 管理员输入以下信息:
   - 所属机房
   - 服务器名称
   - 管理网IP地址
   - 服务器规格（CPU、内存）
   - 管理功能启用列表:
     - [ ] 管理实例
     - [ ] 管理用户
     - [ ] 管理共享资源
     - [ ] 管理数据盘
     - [ ] 管理云盒
4. 系统验证输入信息:
   - 管理网IP地址唯一性
   - 管理网IP地址在机房管理网网段内
   - 至少选择一个管理功能
5. 系统创建管理服务器记录
6. 系统根据选择的管理功能配置服务器:
   - 初始化对应的管理服务组件
   - 配置服务端口和访问接口
   - 设置服务权限和访问控制
7. 系统返回服务器ID和配置指南

**后置条件**:
- 管理服务器已创建
- 所选管理功能已启用并可提供服务

**说明**: 管理服务器不占用机房的计算和存储资源统计

**异常流程**:
- 4a. 如果管理网IP地址已被占用:
  - 系统提示IP冲突
  - 返回步骤3
- 4b. 如果管理网IP地址不在机房管理网网段内:
  - 系统提示IP地址超出管理网范围
  - 显示机房管理网网段信息
  - 返回步骤3

---

### 2.2 添加数据盘服务器 (Add Data Disk Server)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 目标机房存在且状态为 \`active\` 或 \`maintenance\`

**基本流程**:
1. 管理员选择"添加数据盘服务器"功能
2. 系统显示服务器信息表单
3. 管理员输入以下信息:
   - 所属机房
   - 服务器名称
   - 管理网IP地址
   - 业务网IP地址
4. 系统验证输入信息:
   - 管理网IP地址唯一性且在管理网网段内
   - 业务网IP地址唯一性且在业务网网段内
5. 系统创建数据盘服务器记录
6. 系统初始化存储统计:
   - 总存储容量 = 0
   - 已用存储容量 = 0
7. 系统返回服务器ID

**后置条件**:
- 数据盘服务器已创建
- 存储容量初始化为0，等待添加数据盘

**说明**: 数据盘服务器的存储容量会在添加数据盘时自动累加统计，无需手工设置

---

### 2.3 添加文件服务器 (Add File Server)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 目标机房存在且状态为 \`active\` 或 \`maintenance\`

**基本流程**:
1. 管理员选择"添加文件服务器"功能
2. 系统显示服务器信息表单
3. 管理员输入以下信息:
   - 所属机房
   - 服务器名称
   - 管理网IP地址
   - 存储容量 (GB)
   - 文件服务类型:
     - [ ] 镜像库 (Image Repository)
     - [ ] 模板库 (Template Repository)
4. 系统验证输入信息:
   - 管理网IP地址唯一性且在管理网网段内
   - 至少选择一个文件服务类型
5. 系统创建文件服务器记录
6. 系统初始化对应的存储库结构
7. 系统配置访问权限和网络路径
8. 系统自动累加机房资源统计:
   - 总存储容量 += 存储容量
9. 系统返回服务器ID和访问地址

**后置条件**:
- 文件服务器已创建
- 存储库目录结构已初始化
- 访问路径已配置
- 机房总存储容量统计已自动更新

**异常流程**:
- 4a. 如果未选择任何文件服务类型:
  - 系统提示至少选择一种类型
  - 返回步骤3

---

### 2.4 查看服务器状态 (View Server Status)

**参与者**: 系统管理员、运维人员

**前置条件**:
- 用户已登录系统
- 用户具有服务器查看权限

**基本流程**:
1. 用户进入机房详情页
2. 用户选择"服务器列表"标签
3. 系统显示所有服务器列表，按类型分组:
   - 管理服务器组
   - 数据盘服务器组
   - 文件服务器组
4. 每个服务器显示:
   - 服务器名称和IP
   - 运行状态 (online/offline/error)
   - 资源使用率
   - 健康状态
5. 用户可点击查看单个服务器详情:
   - 硬件信息
   - 运行指标
   - 最近事件日志
   - 关联资源

**后置条件**:
- 用户获得服务器状态信息

---

### 2.5 服务器健康检查 (Server Health Check)

**参与者**: 系统（自动任务）、运维人员

**前置条件**:
- 服务器已注册到系统
- 健康检查服务已启用

**基本流程**:
1. 系统定期（每分钟）执行健康检查
2. 对每个服务器执行以下检查:
   - 网络连通性检查（ping）
   - 服务端口可用性检查
   - CPU使用率检查
   - 内存使用率检查
   - 磁盘使用率检查
   - 服务进程状态检查
3. 系统记录检查结果
4. 如果检查失败:
   - 记录失败详情
   - 更新服务器健康状态
   - 如果连续失败3次，标记为 \`error\` 状态
   - 触发告警通知运维人员
5. 如果检查成功:
   - 更新最后健康检查时间
   - 如果之前为 \`error\` 状态，恢复为 \`online\`

**后置条件**:
- 服务器健康状态已更新
- 监控指标已记录

**异常流程**:
- 4a. 如果服务器连续失败达到阈值:
  - 发送紧急告警
  - 标记服务器为 \`offline\`
  - 如果是关键服务器，触发故障转移流程

---

### 2.6 服务器维护模式 (Server Maintenance Mode)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 目标服务器存在

**基本流程**:
1. 管理员进入服务器详情页
2. 管理员选择"进入维护模式"操作
3. 系统检查服务器当前负载:
   - 如果是管理服务器，检查是否有备用服务器
   - 如果是数据盘服务器，检查关联的数据盘数量
   - 如果是算力机，检查运行中的实例数量
4. 系统显示影响评估报告
5. 管理员选择维护策略:
   - 立即进入（强制）
   - 等待任务完成后进入（优雅停机）
   - 迁移负载后进入（推荐）
6. 管理员确认操作
7. 系统执行相应策略
8. 服务器进入维护模式
9. 系统发送维护通知

**后置条件**:
- 服务器状态为 \`maintenance\`
- 不再接受新任务
- 维护记录已创建

---

## 3. 算力机管理

### 3.1 注册算力机 (Register Compute Machine)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 目标机房存在
- 物理算力机已准备就绪

**基本流程**:
1. 管理员选择"注册算力机"功能
2. 系统显示注册表单
3. 管理员输入以下信息:
   - 所属机房
   - 算力机名称
   - 管理网IP地址
   - 业务网IP地址
   - 硬件规格:
     - CPU核心数
     - 内存容量 (GB)
     - GPU型号和数量（可选）
     - 本地存储容量 (GB)
   - 虚拟化平台类型 (KVM/VMware/Hyper-V等)
4. 系统验证输入信息:
   - 管理网IP地址唯一性且在管理网网段内
   - 业务网IP地址唯一性且在业务网网段内
5. 系统尝试连接算力机管理接口
6. 系统读取实际硬件信息并与输入对比
7. 系统创建算力机记录
8. 系统创建对应的算力池
9. 系统自动累加机房资源统计:
   - 总CPU核心数 += CPU核心数
   - 总内存容量 += 内存容量
10. 系统初始化资源监控
11. 系统返回注册成功信息和资源池ID

**后置条件**:
- 算力机已注册
- 算力池已创建
- 机房计算资源统计已自动更新(CPU和内存)
- 资源监控已启动

**说明**: 算力机的本地存储用于虚拟机系统盘,不计入机房总存储容量统计

**异常流程**:
- 5a. 如果无法连接到管理接口:
  - 系统提示连接失败
  - 显示网络诊断信息
  - 返回步骤3或操作取消
- 6a. 如果实际硬件与输入不符:
  - 系统显示差异对比
  - 询问是否使用实际检测值
  - 管理员选择使用哪个值

---

### 3.2 查看算力机资源使用情况 (View Compute Machine Resource Usage)

**参与者**: 系统管理员、运维人员

**前置条件**:
- 用户已登录系统
- 用户具有算力机查看权限
- 算力机已注册

**基本流程**:
1. 用户进入机房详情页
2. 用户选择"算力机列表"标签
3. 系统显示算力机列表，包含:
   - 算力机名称
   - 运行状态
   - CPU使用率
   - 内存使用率
   - 运行实例数
   - 负载均衡分数
4. 用户选择查看某个算力机详情
5. 系统显示详细信息:
   - 硬件配置
   - 实时资源使用情况（图表）
   - 运行中的实例列表
   - 资源分配明细
   - 性能指标趋势
   - 最近事件日志
6. 用户可导出资源使用报表

**后置条件**:
- 用户获得算力机资源使用信息

---

### 3.3 算力机负载均衡 (Compute Machine Load Balancing)

**参与者**: 系统（自动任务）

**前置条件**:
- 机房内存在多个可用算力机
- 负载均衡服务已启用

**基本流程**:
1. 系统定期（每5分钟）评估负载均衡状态
2. 系统收集所有算力机的负载指标:
   - CPU使用率
   - 内存使用率
   - 运行实例数
   - 网络流量
   - 磁盘I/O
3. 系统计算每个算力机的负载分数
4. 系统识别高负载和低负载的算力机
5. 如果负载不均衡（最大差异 > 30%）:
   - 选择可迁移的实例（非固定实例）
   - 计算最优迁移方案
   - 生成迁移建议
   - 如果启用自动迁移，执行迁移
   - 如果手动模式，通知管理员审核
6. 更新负载均衡记录

**后置条件**:
- 负载评估已完成
- 必要时执行实例迁移
- 负载状态已更新

---

### 3.4 算力机上线/下线 (Compute Machine Online/Offline)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 目标算力机存在

**基本流程（上线）**:
1. 管理员进入算力机详情页
2. 管理员选择"上线"操作
3. 系统执行健康检查:
   - 网络连通性
   - 虚拟化服务状态
   - 资源可用性
4. 系统显示检查结果
5. 管理员确认上线
6. 系统更新算力机状态为 \`online\`
7. 系统将算力机加入调度池
8. 系统发送上线通知

**基本流程（下线）**:
1. 管理员进入算力机详情页
2. 管理员选择"下线"操作
3. 系统检查运行中的实例
4. 系统显示影响评估:
   - 运行实例列表
   - 受影响用户数
   - 建议迁移方案
5. 管理员选择下线策略:
   - 等待实例停止（优雅下线）
   - 迁移实例到其他算力机
   - 强制下线
6. 管理员确认操作
7. 系统执行下线策略
8. 系统更新算力机状态为 \`offline\`
9. 系统从调度池移除算力机
10. 系统记录下线日志

**后置条件**:
- 算力机状态已更新
- 调度策略已调整
- 操作已记录

**异常流程**:
- 3a. 如果有运行中的实例且选择优雅下线:
  - 系统等待所有实例停止
  - 设置超时时间（默认30分钟）
  - 如果超时，提示管理员选择强制下线或继续等待

---

### 3.5 算力机性能监控 (Compute Machine Performance Monitoring)

**参与者**: 系统（自动任务）、运维人员

**前置条件**:
- 算力机已注册且在线
- 监控服务已启用

**基本流程**:
1. 系统持续采集算力机性能数据（每30秒）:
   - CPU使用率（总体和每核）
   - 内存使用率和可用内存
   - 磁盘I/O（读写速率）
   - 网络流量（入站/出站）
   - GPU使用率（如果有）
   - 虚拟化层资源开销
2. 系统存储性能数据到时序数据库
3. 系统计算性能指标:
   - 平均负载
   - 资源峰值
   - 响应时间
4. 系统检测异常模式:
   - CPU持续高负载（>90%超过5分钟）
   - 内存不足告警（<10%可用）
   - 磁盘I/O瓶颈
   - 网络带宽饱和
5. 如果检测到异常:
   - 触发告警
   - 记录事件日志
   - 通知运维人员
6. 系统生成性能报表（每日）

**后置条件**:
- 性能数据已记录
- 异常已检测和通知
- 性能报表可查看

---

## 4. 云盒管理

### 4.1 注册云盒 (Register Cloud Box)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 云盒设备已接入网络
- 云盒设备已获取IP地址

**基本流程**:
1. 管理员选择"注册云盒"功能
2. 系统显示注册表单
3. 管理员输入以下信息:
   - 所属机房
   - 云盒序列号（设备唯一标识）
   - 云盒名称
   - 云盒IP地址
   - 云盒MAC地址
   - 位置信息（可选）
   - 设备型号
   - 固件版本
4. 系统验证序列号唯一性
5. 系统尝试连接云盒设备
6. 系统读取云盒硬件信息:
   - CPU型号和核心数
   - 内存容量
   - 存储容量
   - 支持的协议（VDI/RDP/VNC等）
7. 系统创建云盒记录
8. 系统初始化云盒配置
9. 系统返回注册成功信息

**后置条件**:
- 云盒已注册到系统
- 云盒状态为 \`registered\`
- 设备监控已启动

**异常流程**:
- 4a. 如果序列号已存在:
  - 系统提示设备已注册
  - 显示现有记录
  - 询问是否重新注册（覆盖）
- 5a. 如果无法连接到云盒:
  - 系统提示连接失败
  - 提供网络诊断建议
  - 允许离线注册（稍后激活）

---

### 4.2 分配云盒给用户 (Assign Cloud Box to User)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 云盒已注册且状态为 \`idle\`
- 目标用户存在

**基本流程**:
1. 管理员进入云盒管理页面
2. 管理员选择要分配的云盒
3. 系统显示可分配用户列表（未绑定云盒的用户）
4. 管理员选择目标用户
5. 管理员可选配置:
   - 分配时长（长期/临时）
   - 默认连接实例（可选）
   - 访问权限设置
6. 系统验证用户是否有权使用云盒
7. 系统创建云盒-用户绑定关系
8. 系统更新云盒状态为 \`assigned\`
9. 系统发送配置信息到云盒设备
10. 系统通知用户（邮件/站内信）
11. 系统返回分配成功信息

**后置条件**:
- 云盒已分配给用户
- 用户可使用云盒登录
- 分配记录已保存

**异常流程**:
- 6a. 如果用户不符合使用条件:
  - 系统提示原因（配额不足、权限不够等）
  - 操作取消

---

### 4.3 云盒远程控制 (Cloud Box Remote Control)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 云盒已注册且在线

**基本流程**:
1. 管理员进入云盒详情页
2. 管理员选择"远程控制"功能
3. 系统显示可用操作列表:
   - 重启设备
   - 关闭设备
   - 更新固件
   - 清除缓存
   - 重置网络配置
   - 解绑用户
4. 管理员选择操作类型
5. 系统显示操作说明和影响提示
6. 管理员确认操作
7. 系统发送控制命令到云盒
8. 云盒执行命令并返回结果
9. 系统记录操作日志
10. 系统显示执行结果

**后置条件**:
- 云盒已执行相应操作
- 操作结果已反馈
- 操作日志已记录

**异常流程**:
- 7a. 如果云盒离线:
  - 系统提示设备不可达
  - 询问是否加入待执行队列（设备上线后执行）
- 8a. 如果命令执行失败:
  - 系统记录错误信息
  - 提示管理员检查设备状态
  - 提供重试选项

---

### 4.4 云盒固件升级 (Cloud Box Firmware Update)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 云盒已注册
- 新版本固件已上传到系统

**基本流程**:
1. 管理员进入云盒管理页面
2. 管理员选择"批量固件升级"或单个云盒升级
3. 系统显示:
   - 当前固件版本
   - 可用的新版本列表
   - 版本更新说明
4. 管理员选择目标版本
5. 管理员选择升级策略:
   - 立即升级
   - 计划升级（指定时间）
   - 滚动升级（分批进行）
6. 系统检查兼容性和前置条件
7. 管理员确认升级计划
8. 系统按计划执行升级:
   - 下载固件到云盒
   - 验证固件完整性
   - 备份当前配置
   - 执行固件更新
   - 重启设备
   - 验证升级结果
9. 系统更新云盒固件版本记录
10. 系统发送升级报告

**后置条件**:
- 云盒固件已升级
- 设备配置已保留
- 升级记录已保存

**异常流程**:
- 8a. 如果升级失败:
  - 系统尝试回滚到旧版本
  - 恢复备份配置
  - 记录失败详情
  - 通知管理员处理
- 8b. 如果升级后验证失败:
  - 标记设备为异常状态
  - 自动回滚
  - 通知管理员人工介入

---

### 4.5 云盒状态监控 (Cloud Box Status Monitoring)

**参与者**: 系统（自动任务）、运维人员

**前置条件**:
- 云盒已注册
- 监控服务已启用

**基本流程**:
1. 系统定期（每分钟）检查云盒状态:
   - 网络连通性（ping）
   - 在线状态
   - 设备健康状态
   - CPU温度（如果支持）
   - 固件版本
   - 最后活动时间
2. 系统记录状态数据
3. 系统检测异常情况:
   - 设备离线超过5分钟
   - CPU过热
   - 频繁重启
   - 连接不稳定
4. 如果检测到异常:
   - 更新云盒状态为 \`error\` 或 \`warning\`
   - 触发告警
   - 记录事件日志
   - 通知运维人员和相关用户
5. 系统生成云盒健康报告（每日）

**后置条件**:
- 云盒状态已更新
- 异常已检测和通知
- 监控数据已记录

---

### 4.6 云盒使用情况统计 (Cloud Box Usage Statistics)

**参与者**: 系统管理员、运营人员

**前置条件**:
- 用户已登录系统
- 用户具有统计报表查看权限

**基本流程**:
1. 用户进入"云盒统计"页面
2. 用户选择统计维度:
   - 按机房统计
   - 按状态统计
   - 按用户统计
   - 按时间范围统计
3. 用户设置筛选条件
4. 系统查询并计算统计数据:
   - 总云盒数量
   - 在线/离线/异常数量
   - 已分配/未分配数量
   - 设备使用率
   - 平均在线时长
   - 故障率
   - 用户活跃度
5. 系统生成可视化图表:
   - 状态分布饼图
   - 使用趋势折线图
   - 机房分布柱状图
   - TOP用户排行
6. 用户可导出统计报表（Excel/PDF）

**后置条件**:
- 用户获得统计数据和报表

---

### 4.7 云盒批量操作 (Cloud Box Batch Operations)

**参与者**: 系统管理员

**前置条件**:
- 管理员已登录系统
- 系统中存在多个云盒

**基本流程**:
1. 管理员进入云盒列表页
2. 管理员使用筛选条件选择云盒:
   - 按机房筛选
   - 按状态筛选
   - 按固件版本筛选
   - 按分配状态筛选
3. 系统显示符合条件的云盒列表
4. 管理员勾选目标云盒（或全选）
5. 管理员选择批量操作类型:
   - 批量重启
   - 批量固件升级
   - 批量解绑用户
   - 批量修改配置
   - 批量下线
6. 系统显示影响评估:
   - 选中设备数量
   - 受影响用户列表
   - 预计执行时间
7. 管理员确认操作
8. 系统创建批量任务
9. 系统异步执行批量操作:
   - 逐个处理（避免资源争抢）
   - 记录每个操作结果
   - 失败时继续处理其他设备
10. 系统生成批量操作报告
11. 系统通知管理员任务完成

**后置条件**:
- 批量操作已执行
- 操作结果已记录
- 报告可查看

**异常流程**:
- 9a. 如果部分设备操作失败:
  - 系统继续处理剩余设备
  - 记录失败设备清单
  - 在报告中标注失败原因
  - 提供重试选项

---

## 附录

### 状态定义

#### 机房状态
- \`active\`: 正常运营，可接受新资源
- \`maintenance\`: 维护中，不接受新资源但保持现有服务
- \`offline\`: 离线，所有服务不可用

#### 服务器状态
- \`online\`: 在线正常工作
- \`offline\`: 离线不可用
- \`error\`: 错误状态需要处理
- \`maintenance\`: 维护模式

#### 算力机状态
- \`online\`: 在线可调度
- \`offline\`: 离线不可用
- \`full\`: 资源已满
- \`maintenance\`: 维护中

#### 云盒状态
- \`registered\`: 已注册未激活
- \`idle\`: 空闲可分配
- \`assigned\`: 已分配给用户
- \`online\`: 在线工作中
- \`offline\`: 离线
- \`error\`: 异常状态
- \`warning\`: 警告状态

---

### 网络说明

机房采用双网架构，网络职责分离：

#### 管理网 (Management Network)
- **用途**: 设备管理、监控、配置等管理流量
- **接入设备**:
  - 管理服务器（仅管理网）
  - 数据盘服务器（管理网 + 业务网）
  - 文件服务器（仅管理网）
  - 算力机（管理网 + 业务网）
- **特点**:
  - 独立网段，与业务网隔离
  - 访问控制严格，仅管理人员可访问
  - 用于设备健康检查、性能监控、远程控制等

#### 业务网 (Business Network)
- **用途**: 虚拟机实例流量、用户访问、数据传输等业务流量
- **接入设备**:
  - 数据盘服务器（提供存储服务）
  - 算力机（虚拟机网络流量）
- **特点**:
  - 独立网段，与管理网隔离
  - 承载用户业务流量
  - 虚拟机实例通过业务网访问存储和网络

**注意**: 管理网和业务网网段必须不重叠，所有设备IP必须在所属网段范围内

---

### 权限说明

- **系统管理员**: 拥有所有机房管理权限
- **运维人员**: 可查看状态、执行维护操作
- **运营人员**: 可查看统计报表和使用情况

---

### 通知策略

系统在以下情况发送通知:
1. 设备状态异常（发送给运维人员）
2. 资源使用率达到阈值（发送给管理员）
3. 云盒分配给用户（发送给用户）
4. 批量操作完成（发送给操作者）
5. 固件升级完成（发送给管理员和运维）

---

*文档版本: 1.0*
*最后更新: 2025-10-31*
