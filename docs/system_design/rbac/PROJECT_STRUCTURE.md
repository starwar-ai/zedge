# RBAC é¡¹ç›®ç»“æ„ä¸€è§ˆ

## ğŸ“‚ å®Œæ•´ç›®å½•ç»“æ„

```
zedge/
â”‚
â”œâ”€â”€ ğŸ“„ QUICK_START.md                          # 5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨æŒ‡å—
â”œâ”€â”€ ğŸ“„ RBAC_IMPLEMENTATION_SUMMARY.md          # RBACå®ç°æ€»ç»“
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.md                    # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ“ backend/                                # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ ğŸ“„ README.md                           # åç«¯æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“„ package.json                        # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ tsconfig.json                       # TypeScripté…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ .env.example                        # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ prisma/                             # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â””â”€â”€ ğŸ“„ schema.prisma                   # Prismaæ•°æ®åº“æ¨¡å‹ (300+ è¡Œ)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ scripts/                            # åˆå§‹åŒ–è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ init-permissions.ts             # åˆå§‹åŒ–æƒé™æ•°æ®
â”‚   â”‚   â””â”€â”€ ğŸ“„ create-admin.ts                 # åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ src/                                # æºä»£ç 
â”‚       â”œâ”€â”€ ğŸ“ middleware/                     # Expressä¸­é—´ä»¶
â”‚       â”‚   â”œâ”€â”€ ğŸ“„ auth.middleware.ts          # JWTè®¤è¯ (150+ è¡Œ)
â”‚       â”‚   â””â”€â”€ ğŸ“„ permission.middleware.ts    # æƒé™éªŒè¯ (350+ è¡Œ)
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ services/                       # ä¸šåŠ¡é€»è¾‘å±‚
â”‚       â”‚   â”œâ”€â”€ ğŸ“ permission/
â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“„ permission.service.ts   # æƒé™æœåŠ¡ (350+ è¡Œ)
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ ğŸ“ tenant/
â”‚       â”‚   â”‚   â”œâ”€â”€ ğŸ“„ tenant.service.ts       # ç§Ÿæˆ·æœåŠ¡ (200+ è¡Œ)
â”‚       â”‚   â”‚   â””â”€â”€ ğŸ“„ tenant.controller.ts    # ç§Ÿæˆ·æ§åˆ¶å™¨ (200+ è¡Œ)
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ ğŸ“ user/
â”‚       â”‚       â”œâ”€â”€ ğŸ“„ user.service.ts         # ç”¨æˆ·æœåŠ¡ (280+ è¡Œ)
â”‚       â”‚       â””â”€â”€ ğŸ“„ user.controller.ts      # ç”¨æˆ·æ§åˆ¶å™¨ (220+ è¡Œ)
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ routes/                         # APIè·¯ç”±
â”‚       â”‚   â”œâ”€â”€ ğŸ“„ auth.routes.ts              # è®¤è¯è·¯ç”± (140+ è¡Œ)
â”‚       â”‚   â”œâ”€â”€ ğŸ“„ tenant.routes.ts            # ç§Ÿæˆ·è·¯ç”± (80+ è¡Œ)
â”‚       â”‚   â””â”€â”€ ğŸ“„ user.routes.ts              # ç”¨æˆ·è·¯ç”± (90+ è¡Œ)
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ types/                          # ç±»å‹å®šä¹‰
â”‚       â”‚   â””â”€â”€ ğŸ“„ express.d.ts                # Expressç±»å‹æ‰©å±•
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“ utils/                          # å·¥å…·å‡½æ•°
â”‚           â””â”€â”€ ğŸ“„ prisma.client.ts            # Prisma Clientå•ä¾‹
â”‚
â”œâ”€â”€ ğŸ“ frontend/                               # å‰ç«¯é¡¹ç›®
â”‚   â””â”€â”€ ğŸ“ src/
â”‚       â”œâ”€â”€ ğŸ“ hooks/                          # React Hooks
â”‚       â”‚   â””â”€â”€ ğŸ“„ useAuth.ts                  # è®¤è¯Hook (180+ è¡Œ)
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ components/                     # Reactç»„ä»¶
â”‚       â”‚   â””â”€â”€ ğŸ“„ PermissionGuard.tsx         # æƒé™å®ˆå«ç»„ä»¶ (120+ è¡Œ)
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“ types/                          # ç±»å‹å®šä¹‰
â”‚           â””â”€â”€ ğŸ“„ auth.ts                     # è®¤è¯ç±»å‹ (80+ è¡Œ)
â”‚
â””â”€â”€ ğŸ“ docs/                                   # æ–‡æ¡£
    â””â”€â”€ ğŸ“„ RBAC_GUIDE.md                       # RBACå®Œæ•´ä½¿ç”¨æŒ‡å— (600+ è¡Œ)
```

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

### ä»£ç ç»Ÿè®¡

| ç±»åˆ« | æ–‡ä»¶æ•° | ä»£ç è¡Œæ•° |
|------|--------|----------|
| **åç«¯ä»£ç ** | 15 | ~2,500 è¡Œ |
| **å‰ç«¯ä»£ç ** | 3 | ~380 è¡Œ |
| **æ–‡æ¡£** | 4 | ~1,000 è¡Œ |
| **é…ç½®æ–‡ä»¶** | 3 | ~100 è¡Œ |
| **æ€»è®¡** | 25 | **~3,980 è¡Œ** |

### åŠŸèƒ½æ¨¡å—

| æ¨¡å— | æ–‡ä»¶æ•° | è¯´æ˜ |
|------|--------|------|
| ğŸ—„ï¸ **æ•°æ®åº“æ¨¡å‹** | 1 | Prisma Schema, 11å¼ è¡¨ |
| ğŸ” **è®¤è¯ç³»ç»Ÿ** | 2 | JWT Tokenç”Ÿæˆå’ŒéªŒè¯ |
| ğŸ›¡ï¸ **æƒé™ç³»ç»Ÿ** | 2 | 6ç§æƒé™ä¸­é—´ä»¶ |
| ğŸ‘¥ **ç”¨æˆ·ç®¡ç†** | 2 | å®Œæ•´çš„CRUD + å¯†ç ç®¡ç† |
| ğŸ¢ **ç§Ÿæˆ·ç®¡ç†** | 2 | å®Œæ•´çš„CRUD + é…é¢ç®¡ç† |
| ğŸ”‘ **æƒé™æœåŠ¡** | 1 | 54ä¸ªé¢„å®šä¹‰æƒé™ |
| ğŸ›£ï¸ **APIè·¯ç”±** | 3 | 20+ APIç«¯ç‚¹ |
| âš›ï¸ **å‰ç«¯Hooks** | 1 | 10+ æƒé™æ£€æŸ¥æ–¹æ³• |
| ğŸ§© **å‰ç«¯ç»„ä»¶** | 1 | 5ä¸ªæƒé™å®ˆå«ç»„ä»¶ |
| ğŸ“ **è„šæœ¬å·¥å…·** | 2 | åˆå§‹åŒ–å’Œç®¡ç†å·¥å…· |

## ğŸ”‘ æ ¸å¿ƒç‰¹æ€§

### 1ï¸âƒ£ å››ç§ç”¨æˆ·è§’è‰²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  admin          â”‚  ç³»ç»Ÿç®¡ç†å‘˜ - å…¨éƒ¨æƒé™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  tenant_admin   â”‚  ç§Ÿæˆ·ç®¡ç†å‘˜ - ç§Ÿæˆ·å†…å…¨éƒ¨æƒé™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  operator       â”‚  è¿ç»´äººå‘˜ - èµ„æºç®¡ç†æƒé™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  user           â”‚  æ™®é€šç”¨æˆ· - è‡ªæœ‰èµ„æºæƒé™
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2ï¸âƒ£ ä¹ç§èµ„æºç±»å‹

- ğŸ¢ TENANT - ç§Ÿæˆ·
- ğŸ‘¤ USER - ç”¨æˆ·
- ğŸ‘¥ USER_GROUP - ç”¨æˆ·ç»„
- ğŸ’» INSTANCE - å®ä¾‹
- ğŸ’¾ STORAGE - å­˜å‚¨
- ğŸŒ NETWORK - ç½‘ç»œ
- ğŸ“¦ IMAGE - é•œåƒ
- ğŸ–¥ï¸ SERVER - æœåŠ¡å™¨
- ğŸ­ EDGE_DC - è¾¹ç¼˜æœºæˆ¿

### 3ï¸âƒ£ å…­ç§æ“ä½œæƒé™

- â• CREATE - åˆ›å»º
- ğŸ‘ï¸ READ - è¯»å–
- âœï¸ UPDATE - æ›´æ–°
- ğŸ—‘ï¸ DELETE - åˆ é™¤
- ğŸ”§ MANAGE - ç®¡ç†
- â–¶ï¸ EXECUTE - æ‰§è¡Œ

## ğŸ¯ API ç«¯ç‚¹æ€»è§ˆ

### è®¤è¯ API (3ä¸ª)

```
POST   /api/v1/auth/login          # ç”¨æˆ·ç™»å½•
POST   /api/v1/auth/refresh        # åˆ·æ–°Token
POST   /api/v1/auth/logout         # ç”¨æˆ·ç™»å‡º
```

### ç§Ÿæˆ·ç®¡ç† API (6ä¸ª)

```
POST   /api/v1/tenants             # åˆ›å»ºç§Ÿæˆ·
GET    /api/v1/tenants             # è·å–ç§Ÿæˆ·åˆ—è¡¨
GET    /api/v1/tenants/:id         # è·å–ç§Ÿæˆ·è¯¦æƒ…
PATCH  /api/v1/tenants/:id         # æ›´æ–°ç§Ÿæˆ·
DELETE /api/v1/tenants/:id         # åˆ é™¤ç§Ÿæˆ·
GET    /api/v1/tenants/:id/quota   # è·å–ç§Ÿæˆ·é…é¢
```

### ç”¨æˆ·ç®¡ç† API (8ä¸ª)

```
GET    /api/v1/users/me                    # è·å–å½“å‰ç”¨æˆ·
POST   /api/v1/users                       # åˆ›å»ºç”¨æˆ·
GET    /api/v1/users                       # è·å–ç”¨æˆ·åˆ—è¡¨
GET    /api/v1/users/:id                   # è·å–ç”¨æˆ·è¯¦æƒ…
PATCH  /api/v1/users/:id                   # æ›´æ–°ç”¨æˆ·
DELETE /api/v1/users/:id                   # åˆ é™¤ç”¨æˆ·
POST   /api/v1/users/:id/change-password   # ä¿®æ”¹å¯†ç 
POST   /api/v1/users/:id/reset-password    # é‡ç½®å¯†ç 
```

## ğŸ—ƒï¸ æ•°æ®åº“æ¨¡å‹

### æ ¸å¿ƒè¡¨ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  tenants (ç§Ÿæˆ·è¡¨)                        â”‚
â”‚  - tenant_id (UUID, PK)                  â”‚
â”‚  - name (å”¯ä¸€)                           â”‚
â”‚  - quota_config (JSONB)                  â”‚
â”‚  - vlan_id (å”¯ä¸€)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ 1:N
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  users (ç”¨æˆ·è¡¨)                          â”‚
â”‚  - user_id (UUID, PK)                    â”‚
â”‚  - username (å”¯ä¸€)                       â”‚
â”‚  - email (å”¯ä¸€)                          â”‚
â”‚  - password_hash                         â”‚
â”‚  - role (æšä¸¾)                           â”‚
â”‚  - tenant_id (FK)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  instances   â”‚      â”‚  data_disks  â”‚
â”‚  (å®ä¾‹è¡¨)    â”‚      â”‚  (å­˜å‚¨è¡¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  permissions (æƒé™è¡¨)                    â”‚
â”‚  - permission_id (UUID, PK)              â”‚
â”‚  - resource_type (æšä¸¾)                  â”‚
â”‚  - action (æšä¸¾)                         â”‚
â”‚  - permission_name (å”¯ä¸€)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ N:M
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  role_permissions (è§’è‰²æƒé™å…³è”è¡¨)       â”‚
â”‚  - role (æšä¸¾)                           â”‚
â”‚  - permission_id (FK)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“– æ–‡æ¡£è¯´æ˜

### [QUICK_START.md](QUICK_START.md)
- **ç”¨é€”**: 5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨æŒ‡å—
- **å†…å®¹**: ç¯å¢ƒé…ç½®ã€å®‰è£…æ­¥éª¤ã€åŸºæœ¬ä½¿ç”¨
- **é€‚åˆ**: æ–°æ‰‹å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹

### [RBAC_GUIDE.md](RBAC_GUIDE.md)
- **ç”¨é€”**: å®Œæ•´çš„RBACä½¿ç”¨æŒ‡å—
- **å†…å®¹**: ç³»ç»Ÿæ¦‚è¿°ã€APIä½¿ç”¨ã€å‰åç«¯é›†æˆã€æœ€ä½³å®è·µ
- **é€‚åˆ**: æ·±å…¥äº†è§£ç³»ç»Ÿç»†èŠ‚

### [backend/README.md](../../backend/README.md)
- **ç”¨é€”**: åç«¯é¡¹ç›®æ–‡æ¡£
- **å†…å®¹**: æŠ€æœ¯æ ˆã€é¡¹ç›®ç»“æ„ã€å¼€å‘æŒ‡å—
- **é€‚åˆ**: åç«¯å¼€å‘è€…

### [RBAC_IMPLEMENTATION_SUMMARY.md](RBAC_IMPLEMENTATION_SUMMARY.md)
- **ç”¨é€”**: RBACå®ç°æ€»ç»“
- **å†…å®¹**: åŠŸèƒ½æ¸…å•ã€æ¶æ„è¯´æ˜ã€éƒ¨ç½²å‡†å¤‡
- **é€‚åˆ**: é¡¹ç›®ç®¡ç†è€…å’ŒæŠ€æœ¯è´Ÿè´£äºº

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. å®‰è£…åç«¯ä¾èµ–
cd backend
npm install

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# 3. åˆå§‹åŒ–æ•°æ®åº“
npx prisma migrate dev
npm run init-permissions
npm run create-admin

# 4. å¯åŠ¨æœåŠ¡
npm run dev
```

## ğŸ”— ç›¸å…³é“¾æ¥

- ğŸ“š [å®Œæ•´ä½¿ç”¨æŒ‡å—](RBAC_GUIDE.md)
- ğŸš€ [å¿«é€Ÿå…¥é—¨](QUICK_START.md)
- ğŸ“‹ [å®ç°æ€»ç»“](RBAC_IMPLEMENTATION_SUMMARY.md)
- ğŸ’» [åç«¯æ–‡æ¡£](../../backend/README.md)

---

**é¡¹ç›®**: Zedge RBAC æƒé™ç®¡ç†ç³»ç»Ÿ
**ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**æœ€åæ›´æ–°**: 2025-11-01
